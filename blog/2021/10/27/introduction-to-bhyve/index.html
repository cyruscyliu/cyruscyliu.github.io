
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://github.com/cyruscyliu/cyruscyliu.github.io/blog/2021/10/27/introduction-to-bhyve/">
      
      
        <link rel="prev" href="../../../08/18/display-in-qemu/">
      
      
        <link rel="next" href="../../../11/02/coverage-control-in-libfuzzer/">
      
      
      <link rel="icon" href="../../../../../logo.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>Introduction to Bhyve - Qiang Liu - System Security</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-KWJ9PWFFMZ"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-KWJ9PWFFMZ",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-KWJ9PWFFMZ",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#introduction-to-bhyve" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="Qiang Liu - System Security" class="md-header__button md-logo" aria-label="Qiang Liu - System Security" data-md-component="logo">
      
  <img src="../../../../../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Qiang Liu - System Security
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Introduction to Bhyve
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



  

<nav class="md-nav md-nav--primary md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Qiang Liu - System Security" class="md-nav__button md-logo" aria-label="Qiang Liu - System Security" data-md-component="logo">
      
  <img src="../../../../../logo.png" alt="logo">

    </a>
    Qiang Liu - System Security
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../projects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Projects
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../services/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Services
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Blog
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4" id="__nav_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../tags/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tags
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2023
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2022/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2022
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2021/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2021
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2020/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2020
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2019/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2019
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2018/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2018
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Categories
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Categories
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/diary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    diary
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/how-to-do-research-series/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    how-to-do-research-series
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../category/tech-notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    tech-notes
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../../" class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg>
                        <time datetime="2021-10-27 00:00:00+00:00" class="md-ellipsis">October 27, 2021</time>
                      </div>
                    </li>
                    
                    
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9 3v15h3V3zm3 2 4 13 3-1-4-13zM5 5v13h3V5zM3 19v2h18v-2z"/></svg>
                          <span class="md-ellipsis">
                            in
                            
                              <a href="../../../../category/tech-notes/">tech-notes</a></span>
                        </div>
                      </li>
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg>
                          <span class="md-ellipsis">
                            
                              5 min read
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
            
          </nav>
          
            

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#what-is-bhyve123" class="md-nav__link">
    <span class="md-ellipsis">
      What is Bhyve?123
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#components5" class="md-nav__link">
    <span class="md-ellipsis">
      Components5
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dismistafication" class="md-nav__link">
    <span class="md-ellipsis">
      Dismistafication
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vmx-vmcs-maintenace-instructions" class="md-nav__link">
    <span class="md-ellipsis">
      VMX (VMCS-maintenace) instructions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#some-data-structs" class="md-nav__link">
    <span class="md-ellipsis">
      Some data structs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#bhyve-vmexit-code" class="md-nav__link">
    <span class="md-ellipsis">
      BHyve VMExit code
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BHyve VMExit code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#example-vmexit_inout" class="md-nav__link">
    <span class="md-ellipsis">
      Example: vmexit_inout
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#some-data-structs_1" class="md-nav__link">
    <span class="md-ellipsis">
      Some data structs
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#virtual-devices-dummy-means-very-low-fidelity-old-bhyve" class="md-nav__link">
    <span class="md-ellipsis">
      Virtual devices (dummy means very low fidelity) (Old BHyve)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Virtual devices (dummy means very low fidelity) (Old BHyve)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#virtual-device-initialization" class="md-nav__link">
    <span class="md-ellipsis">
      Virtual device initialization
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extend-btest-like-qtest-to-bhyve" class="md-nav__link">
    <span class="md-ellipsis">
      Extend BTest (like QTest) to BHyve
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  




<h1 id="introduction-to-bhyve">Introduction to Bhyve<a class="headerlink" href="#introduction-to-bhyve" title="Do what you think is right">#</a></h1>
<p>In this short article, I'm going to introduce what is Bhyve, how it works, and
how to modify it.</p>
<!-- more -->

<h2 id="what-is-bhyve123">What is Bhyve?<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup><sup id="fnref:2"><a class="footnote-ref" href="#fn:2">2</a></sup><sup id="fnref:3"><a class="footnote-ref" href="#fn:3">3</a></sup><a class="headerlink" href="#what-is-bhyve123" title="Do what you think is right">#</a></h2>
<ul>
<li>Bhyve, pronounced "beehive", is a hypervisor for FreeBSD.</li>
<li>Bhyve runs on x86_64 host and supports i386 and x86_64 guests.</li>
<li>Bhyve requires VT-x/EPT CPU support (core i*).</li>
<li>Bhyve consists of a kernel module: <code>vmm.ko</code>, a library <code>libvmmapi</code>, and some
utilities <code>bhyve</code>, <code>bhyveload</code>, and <code>bhyvectl</code>. Yes, it works as a kernel model
like <code>KVM</code>.</li>
<li>The source code is in the FreeBSD SVN source repository: sys/amd64/vmm/,
usr.sbin/bhyve/, usr.sbin/bhyveload/, usr.sbin/bhyvectl/, and lib/libvmmapi/</li>
<li>Variants: <a href="https://github.com/machyve/xhyve">xhyve</a><sup id="fnref:4"><a class="footnote-ref" href="#fn:4">4</a></sup>, <a href="https://www.pluribusnetworks.com/products/white-box-os/">Pluribus
Netvisor</a>, <a href="https://bhyvecon.org/bhyvecon2018-Gwydir.pdf">bhyve in
Illumos-based distributions</a>.</li>
</ul>
<h2 id="components5">Components<sup id="fnref:5"><a class="footnote-ref" href="#fn:5">5</a></sup><a class="headerlink" href="#components5" title="Do what you think is right">#</a></h2>
<table>
<thead>
<tr>
<th align="center">component</th>
<th align="center">functionality</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">vmm.ko</td>
<td align="center">VT-x, local APCI, VT-d for PCI pass-thru, guest phymem mgmt, user-space cdev-interface</td>
</tr>
<tr>
<td align="center">bhyveload</td>
<td align="center">user-space bootloader, userboot lib + bhyve API, creates VM, lays out kernel + metadata, sets up initial VM register state</td>
</tr>
<tr>
<td align="center">bhyve</td>
<td align="center">user-space run loop, PCI bus/device emulation, device backends, threads for vCPU, i/o devs, kqueue loop</td>
</tr>
<tr>
<td align="center">bhyvectl</td>
<td align="center">dump/modify VM state, dump VM stats, delete VMs</td>
</tr>
<tr>
<td align="center">libvmmapi</td>
<td align="center">userland API</td>
</tr>
</tbody>
</table>
<h2 id="dismistafication">Dismistafication<a class="headerlink" href="#dismistafication" title="Do what you think is right">#</a></h2>
<ul>
<li>vhyveload only supports FreeBSD, grub2-bhyve can load Linux and OpenBSD</li>
<li>each /dev/vmm/${vmname} contains each VM instance state</li>
<li>VMX-root: hypervisor, VMX-non-root: VM</li>
</ul>
<h2 id="vmx-vmcs-maintenace-instructions">VMX (VMCS-maintenace) instructions<a class="headerlink" href="#vmx-vmcs-maintenace-instructions" title="Do what you think is right">#</a></h2>
<ul>
<li>VMPTRLD — It makes the referenced VMCS active and current.</li>
<li>VMPTRST — The current-VMCS pointer is stored into the destination operand.</li>
<li>VMCLEAR — The instruction sets the launch state of the VMCS referenced by the operand to “clear”, renders that VMCS inactive, and ensures that data for
the VMCS have been written to the VMCS-data area in the referenced VMCS region. If the operand is the same as the current-VMCS pointer, that pointer is made invalid.</li>
<li>VMREAD — This instruction reads a component from a VMCS.</li>
<li>VMWRITE — This instruction writes a component to a VMCS.</li>
<li><strong>VMLAUNCH</strong> — This instruction launches a virtual machine managed by the VMCS. A VM entry occurs, transferring control to the VM.</li>
<li><strong>VMRESUME</strong> — This instruction resumes a virtual machine managed by the VMCS. A VM entry occurs, transferring control to the VM.</li>
<li>VMXOFF — This instruction causes the processor to leave VMX operation.</li>
<li>VMXON — It causes a logical processor to enter VMX root operation. (vmm_init -&gt; vm_init -&gt; vm_enable -&gt; vmxon)</li>
<li>INVEPT — This instruction invalidates entries in the TLBs and paging-structure caches that were derived from extended page tables (EPT).</li>
<li>INVVPID — This instruction invalidates entries in the TLBs and paging-structure caches based on a VirtualProcessor Identifier (VPID).</li>
<li><strong>VMCALL</strong> — This instruction allows software in VMX non-root operation to call the VMM for service. A VM exit occurs, transferring control to the VMM.</li>
<li><strong>VMFUNC</strong> — This instruction allows software in VMX non-root operation to invoke a VM function (processor functionality enabled and configured by software in VMX root operation) without a VM exit.</li>
</ul>
<h2 id="some-data-structs">Some data structs<a class="headerlink" href="#some-data-structs" title="Do what you think is right">#</a></h2>
<div class="highlight"><pre><span></span><code><span class="cp">#define VM_MAXCPU   8</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">vm_exit</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">enum</span><span class="w"> </span><span class="n">vm_exitcode</span><span class="w">    </span><span class="n">exitcode</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w">                 </span><span class="n">inst_length</span><span class="p">;</span><span class="w">    </span><span class="cm">/* 0 means unknown */</span>
<span class="w">    </span><span class="kt">uint64_t</span><span class="w">            </span><span class="n">rip</span><span class="p">;</span>
<span class="w">    </span><span class="k">union</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">struct</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="n">inout</span><span class="p">;</span><span class="w"> </span><span class="c1">// direction, how many bytes, port number, eax for out</span>
<span class="w">        </span><span class="k">struct</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="n">paging</span><span class="p">;</span>
<span class="w">        </span><span class="k">struct</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="n">vmx</span><span class="p">;</span>
<span class="w">        </span><span class="k">struct</span><span class="w"> </span><span class="p">{}</span><span class="w"> </span><span class="n">msr</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="n">u</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span><span class="w"> </span><span class="nc">vm_exit</span><span class="w"> </span><span class="n">vmexit</span><span class="p">[</span><span class="n">VM_MAXCPU</span><span class="p">];</span>
</code></pre></div>
<p>The above code defines exit information for each virtual cpu.</p>
<h2 id="bhyve-vmexit-code">BHyve VMExit code<a class="headerlink" href="#bhyve-vmexit-code" title="Do what you think is right">#</a></h2>
<table>
<thead>
<tr>
<th align="center">code</th>
<th align="center">handler</th>
<th align="center">description</th>
<th align="center">next</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">VM_EXITCODE_INOUT</td>
<td align="center">vmexit_inout</td>
<td align="center">in and out instructions</td>
<td align="center">VMEXIT_CONTINUE or VMEXIT_ABORT</td>
</tr>
<tr>
<td align="center">VM_EXITCODE_VMX</td>
<td align="center">vmexit_vmx</td>
<td align="center">vm exit</td>
<td align="center">VMEXIT_ABORT</td>
</tr>
<tr>
<td align="center">VM_EXITCODE_BOGUS</td>
<td align="center">vmexit_bogus</td>
<td align="center"></td>
<td align="center">VMEXIT_RESTART or VMEXIT_SWITCH</td>
</tr>
<tr>
<td align="center">VM_EXITCODE_RDMSR</td>
<td align="center">vmexit_rdmsr</td>
<td align="center">Local APIC</td>
<td align="center">VMEXIT_ABORT</td>
</tr>
<tr>
<td align="center">VM_EXITCODE_WRMSR</td>
<td align="center">vmexit_wrmsr -&gt; emulate_wrmsr</td>
<td align="center">Local APIC</td>
<td align="center">VMEXIT_CONTINUE or VMEXIT_SWITCH</td>
</tr>
<tr>
<td align="center">VM_EXITCODE_MTRAP</td>
<td align="center">vmexit_mtrap</td>
<td align="center"></td>
<td align="center">VMEXIT_RESTART</td>
</tr>
<tr>
<td align="center">VM_EXITCODE_PAGING</td>
<td align="center">vmexit_paging -&gt; emulate_instruction</td>
<td align="center"></td>
<td align="center">VMEXIT_CONTINUE or VMEXIT_ABORT</td>
</tr>
</tbody>
</table>
<h3 id="example-vmexit_inout">Example: vmexit_inout<a class="headerlink" href="#example-vmexit_inout" title="Do what you think is right">#</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="kt">int</span>
<span class="nf">vmexit_inout</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">vmctx</span><span class="w"> </span><span class="o">*</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">vm_exit</span><span class="w"> </span><span class="o">*</span><span class="n">vme</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">pvcpu</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="c1">// ignore ins/outs</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">vme</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">inout</span><span class="p">.</span><span class="n">string</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">vme</span><span class="o">-&gt;</span><span class="n">u</span><span class="p">.</span><span class="n">inout</span><span class="p">.</span><span class="n">rep</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">VMEXIT_ABORT</span><span class="p">);</span>
<span class="w">    </span><span class="c1">// reset: out 0x64, 0xFE -&gt; vmexit_catch_reset -&gt; VMEXIT_RESET</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0x64</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="p">)</span><span class="n">eax</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mh">0xFE</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">vmexit_catch_reset</span><span class="p">());</span>
<span class="w">    </span><span class="c1">// host notification: out 0x488, {0, 1, 5} -&gt; VMEXIT_CONTINUE</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">port</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">GUEST_NIO_PORT</span><span class="p">)</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">vmexit_handle_notify</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">vme</span><span class="p">,</span><span class="w"> </span><span class="n">pvcpu</span><span class="p">,</span><span class="w"> </span><span class="n">eax</span><span class="p">));</span>
<span class="w">    </span><span class="c1">// handle other in/out</span>
<span class="w">    </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">emulate_inout</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">vcpu</span><span class="p">,</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">port</span><span class="p">,</span><span class="w"> </span><span class="n">bytes</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">eax</span><span class="p">,</span><span class="w"> </span><span class="n">strictio</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">error</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">in</span><span class="p">)</span>
<span class="w">        </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vm_set_register</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span><span class="w"> </span><span class="n">vcpu</span><span class="p">,</span><span class="w"> </span><span class="n">VM_REG_GUEST_RAX</span><span class="p">,</span><span class="w"> </span><span class="n">eax</span><span class="p">);</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">error</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">VMEXIT_CONTINUE</span><span class="p">);</span>
<span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">vmexit_catch_inout</span><span class="p">());</span><span class="w"> </span><span class="c1">// VMEXIT_ABORT</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="some-data-structs_1">Some data structs<a class="headerlink" href="#some-data-structs_1" title="Do what you think is right">#</a></h2>
<div class="highlight"><pre><span></span><code><span class="cp">#define SET_DECLARE(set, ptype)                 \</span>
<span class="cp">    extern ptype *__CONCAT(__start_set_,set);   \</span>
<span class="cp">    extern ptype *__CONCAT(__stop_set_,set)</span>
<span class="cp">#define SET_BEGIN(set)                          \</span>
<span class="cp">    (&amp;__CONCAT(__start_set_,set))</span>
<span class="cp">#define SET_LIMIT(set)                          \</span>
<span class="cp">    (&amp;__CONCAT(__stop_set_,set))</span>
<span class="cp">#define SET_FOREACH(pvar, set)                  \</span>
<span class="cp">    for (pvar = SET_BEGIN(set); pvar &lt; SET_LIMIT(set); pvar++)</span>
<span class="cp">#define SET_ITEM(set, i)                        \</span>
<span class="cp">    ((SET_BEGIN(set))[i])</span>
<span class="cp">#define SET_COUNT(set)                          \</span>
<span class="cp">    (SET_LIMIT(set) - SET_BEGIN(set))</span>

<span class="n">SET_DECLARE</span><span class="p">(</span><span class="n">pci_devemu_set</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">pci_devemu</span><span class="p">);</span>

<span class="k">struct</span><span class="w"> </span><span class="nc">pci_devemu</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kt">char</span><span class="w">      </span><span class="o">*</span><span class="n">pe_emu</span><span class="p">;</span><span class="w">      </span><span class="cm">/* Name of device emulation */</span>
<span class="w">    </span><span class="cm">/* instance creation */</span>
<span class="w">    </span><span class="kt">int</span><span class="w">       </span><span class="p">(</span><span class="o">*</span><span class="n">pe_init</span><span class="p">)(</span><span class="k">struct</span><span class="w"> </span><span class="nc">vmctx</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">pci_devinst</span><span class="w"> </span><span class="o">*</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">opts</span><span class="p">);</span>
<span class="w">    </span><span class="cm">/* config space read/write callbacks */</span>
<span class="w">    </span><span class="kt">int</span><span class="w">       </span><span class="p">(</span><span class="o">*</span><span class="n">pe_cfgwrite</span><span class="p">)(...)</span>
<span class="w">    </span><span class="kt">int</span><span class="w">       </span><span class="p">(</span><span class="o">*</span><span class="n">pe_cfgread</span><span class="p">)(...)</span>
<span class="w">    </span><span class="cm">/* I/O space read/write callbacks */</span>
<span class="w">    </span><span class="kt">void</span><span class="w">      </span><span class="p">(</span><span class="o">*</span><span class="n">pe_iow</span><span class="p">)(...)</span>
<span class="w">    </span><span class="kt">uint32_t</span><span class="w">  </span><span class="p">(</span><span class="o">*</span><span class="n">pe_ior</span><span class="p">)(...)</span>
<span class="p">};</span>

<span class="cp">#ifdef __GNUCLIKE___SECTION</span>
<span class="cp">#define __MAKE_SET(set, sym)                        \</span>
<span class="cp">    __GLOBL(__CONCAT(__start_set_,set));                \</span>
<span class="cp">    __GLOBL(__CONCAT(__stop_set_,set));             \</span>
<span class="cp">    static void const * const __set_##set##_sym_##sym       \</span>
<span class="cp">    __section(&quot;set_&quot; #set) __used = &amp;sym</span>
<span class="cp">#else </span><span class="cm">/* !__GNUCLIKE___SECTION */</span>
<span class="cp">#ifndef lint</span>
<span class="cp">#error this file needs to be ported to your compiler</span>
<span class="cp">#endif </span><span class="cm">/* lint */</span>
<span class="cp">#define __MAKE_SET(set, sym)    extern void const * const (__set_##set##_sym_##sym)</span>
<span class="cp">#endif </span><span class="cm">/* __GNUCLIKE___SECTION */</span>

<span class="cp">#define TEXT_SET(set, sym)  __MAKE_SET(set, sym)</span>
<span class="cp">#define DATA_SET(set, sym)  __MAKE_SET(set, sym)</span>
<span class="cp">#define BSS_SET(set, sym)   __MAKE_SET(set, sym)</span>
<span class="cp">#define ABS_SET(set, sym)   __MAKE_SET(set, sym)</span>
<span class="cp">#define SET_ENTRY(set, sym) __MAKE_SET(set, sym)</span>

<span class="n">PCI_EMUL_SET</span><span class="p">(</span><span class="n">pci_xxx</span><span class="p">);</span>
</code></pre></div>
<p>The above code defines name and callbacks of each PCI devices.</p>
<h2 id="virtual-devices-dummy-means-very-low-fidelity-old-bhyve">Virtual devices (dummy means very low fidelity) (Old BHyve)<a class="headerlink" href="#virtual-devices-dummy-means-very-low-fidelity-old-bhyve" title="Do what you think is right">#</a></h2>
<table>
<thead>
<tr>
<th align="center">peripheral</th>
<th align="center">file</th>
<th align="center">description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">atpic</td>
<td align="center">usr.sbin/bhyve/atpic.c</td>
<td align="center">dummy</td>
</tr>
<tr>
<td align="center">console</td>
<td align="center">usr.sbin/bhyve/consport.c</td>
<td align="center">ttyread|ttywrite</td>
</tr>
<tr>
<td align="center">gdbport</td>
<td align="center">usr.sbin/bhyve/dbgport.c</td>
<td align="center">bind, listen, accept, read|write</td>
</tr>
<tr>
<td align="center">elcr</td>
<td align="center">usr.sbin/bhyve/dbgport.c</td>
<td align="center">dummy</td>
</tr>
<tr>
<td align="center">pit 8254</td>
<td align="center">usr.sbin/bhyve/pit_8254.c</td>
<td align="center">pit_8254_handler</td>
</tr>
<tr>
<td align="center">post</td>
<td align="center">usr.sbin/bhyve/post.c</td>
<td align="center">dummy</td>
</tr>
<tr>
<td align="center">rtc</td>
<td align="center">usr.sbin/bhyve/rtc.c</td>
<td align="center">rtc_addr_handler|rtc_data_handler</td>
</tr>
<tr>
<td align="center">uart</td>
<td align="center">usr.sbin/bhyve/uart.c</td>
<td align="center">dummy</td>
</tr>
<tr>
<td align="center">pci-dummy</td>
<td align="center">usr.sbin/bhyve/pci_emul.c</td>
<td align="center">pci_emul_dinit|pci_emul_diow|pci_emul_dior</td>
</tr>
<tr>
<td align="center">pci-hostbridge</td>
<td align="center">usr.sbin/bhyve/pci_hostbridge.c</td>
<td align="center">pci_hostbridge_init</td>
</tr>
<tr>
<td align="center">pci-passthru</td>
<td align="center">usr.sbin/bhyve/pci_passthru.c</td>
<td align="center">/dev/pci, /dev/io</td>
</tr>
<tr>
<td align="center">pci-uart</td>
<td align="center">usr.sbin/bhyve/pci_uart.c</td>
<td align="center">pci_uart_init|pci_uart_write|pci_uart_read</td>
</tr>
<tr>
<td align="center">pci-virtio-blk</td>
<td align="center">usr.sbin/bhyve/pci_virtio_block.c</td>
<td align="center">pci_vtblk_init|pci_vtblk_write|pci_vtblk_read</td>
</tr>
<tr>
<td align="center">pci-virtio-net</td>
<td align="center">usr.sbin/bhyve/pci_virtio_net.c</td>
<td align="center">pci_vtnet_init|pci_vtnet_write|pci_vtnet_read</td>
</tr>
</tbody>
</table>
<h3 id="virtual-device-initialization">Virtual device initialization<a class="headerlink" href="#virtual-device-initialization" title="Do what you think is right">#</a></h3>
<div class="highlight"><pre><span></span><code>while (c = getopt())
    switch (c)
        case &#39;s&#39;:
            pci_parse_slot(optarg, 0); // not legacy
            break;
        case &#39;S&#39;:
            pci_parse_slot(optarg, 1); // legacy
            break;
        // ------------------------------
        // pci_parse_slot
        // ------------------------------
        // snum is from 0 to 31
        // 0,hostbridge
        // 1,virtio-net,tap0
        // pci_slotinfo[snum].si_name = emul; // hostbridge, virtio-net
        // pci_slotinfo[snum].si_param = config; // null, tap0
        // pci_slotinfo[snum].si_legacy = legacy; // 0, 1
init_inout
    install handler for each port: 
        atpic, console, gdbport, elcr, pci_emu, pit 8254, post, rtc, and uart.
init_pci
    // it depends on opts
    pde = pci_emul_finddev(si-&gt;si_name);
    if (pde != NULL) {
        pci_emul_init(ctx, pde, i, si-&gt;si_param); // invoke -&gt;init
</code></pre></div>
<h2 id="extend-btest-like-qtest-to-bhyve">Extend BTest (like QTest) to BHyve<a class="headerlink" href="#extend-btest-like-qtest-to-bhyve" title="Do what you think is right">#</a></h2>
<p>The idea of BTest is to implement the same primitives as QTest. We can leverage
the PCI interfaces because we are doing in-memory fuzzing rather than doing
traps.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p><a href="https://bhyve.org/">Homepage of Bhyve</a>&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:2">
<p><a href="https://en.wikipedia.org/wiki/Bhyve">Wikipedia of Bhyve</a>&#160;<a class="footnote-backref" href="#fnref:2" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:3">
<p><a href="https://wiki.freebsd.org/bhyve">Q&amp;A of Byyve</a>&#160;<a class="footnote-backref" href="#fnref:3" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:4">
<p><a href="https://www.vpsee.com/2015/06/mac-os-x-hypervisor-xhyve-based-on-bhyve/">xhyve</a>&#160;<a class="footnote-backref" href="#fnref:4" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
<li id="fn:5">
<p><a href="https://people.freebsd.org/~grehan/talks/eurobsdcon_2013_bhyve.pdf">Extending bhyve beyond FreeBD guests</a>&#160;<a class="footnote-backref" href="#fnref:5" title="Jump back to footnote 5 in the text">&#8617;</a></p>
</li>
</ol>
</div>







  
  



  


  



      
    </article>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
        
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../../../08/18/display-in-qemu/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Display in QEMU">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Display in QEMU
              </div>
            </div>
          </a>
        
        
          
          <a href="../../../11/02/coverage-control-in-libfuzzer/" class="md-footer__link md-footer__link--next" aria-label="Next: Coverage Control in libFuzzer">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Coverage Control in libFuzzer
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2018 - 2025, Qiang Liu. All rights reserved.
    </div>
  
  
</div>
      
        
<div class="md-social">
  
    
    
    
    
    <a href="/" target="_blank" rel="noopener" title="Home" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
    </a>
  
    
    
    
    
    <a href="mailto:cyruscyliu@gmail.com" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/in/qiangliu15/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="weixin://dl/chat?ocat01" target="_blank" rel="noopener" title="dl" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.691 2.188C3.891 2.188 0 5.476 0 9.53c0 2.212 1.17 4.203 3.002 5.55a.59.59 0 0 1 .213.665l-.39 1.48c-.019.07-.048.141-.048.213 0 .163.13.295.29.295a.33.33 0 0 0 .167-.054l1.903-1.114a.86.86 0 0 1 .717-.098 10.2 10.2 0 0 0 2.837.403c.276 0 .543-.027.811-.05-.857-2.578.157-4.972 1.932-6.446 1.703-1.415 3.882-1.98 5.853-1.838-.576-3.583-4.196-6.348-8.596-6.348M5.785 5.991c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 0 1-1.162 1.178A1.17 1.17 0 0 1 4.623 7.17c0-.651.52-1.18 1.162-1.18zm5.813 0c.642 0 1.162.529 1.162 1.18a1.17 1.17 0 0 1-1.162 1.178 1.17 1.17 0 0 1-1.162-1.178c0-.651.52-1.18 1.162-1.18m5.34 2.867c-1.797-.052-3.746.512-5.28 1.786-1.72 1.428-2.687 3.72-1.78 6.22.942 2.453 3.666 4.229 6.884 4.229.826 0 1.622-.12 2.361-.336a.72.72 0 0 1 .598.082l1.584.926a.3.3 0 0 0 .14.047c.134 0 .24-.111.24-.247 0-.06-.023-.12-.038-.177l-.327-1.233a.6.6 0 0 1-.023-.156.49.49 0 0 1 .201-.398C23.024 18.48 24 16.82 24 14.98c0-3.21-2.931-5.837-6.656-6.088V8.89c-.135-.01-.27-.027-.407-.03zm-2.53 3.274c.535 0 .969.44.969.982a.976.976 0 0 1-.969.983.976.976 0 0 1-.969-.983c0-.542.434-.982.97-.982zm4.844 0c.535 0 .969.44.969.982a.976.976 0 0 1-.969.983.976.976 0 0 1-.969-.983c0-.542.434-.982.969-.982"/></svg>
    </a>
  
    
    
    
    
    <a href="Qiang_s_CV.pdf" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 9h5.5L13 3.5zM6 2h8l6 6v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4c0-1.11.89-2 2-2m8 18v-1c0-1.33-2.67-2-4-2s-4 .67-4 2v1zm-4-8a2 2 0 0 0-2 2 2 2 0 0 0 2 2 2 2 0 0 0 2-2 2 2 0 0 0-2-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://scholar.google.com/citations?user=fa1uB2sAAAAJ&hl=en" target="_blank" rel="noopener" title="scholar.google.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5.242 13.769 0 9.5 12 0l12 9.5-5.242 4.269C17.548 11.249 14.978 9.5 12 9.5c-2.977 0-5.548 1.748-6.758 4.269M12 10a7 7 0 1 0 0 14 7 7 0 0 0 0-14"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://github.com/cyruscyliu" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.tracking", "navigation.path", "navigation.top", "navigation.footer", "navigation.indexes", "navigation.expand", "toc.integrate", "footer.prev_next", "revision.date", "revision.history"], "search": "../../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>