<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="generator" content="mkdocs-1.6.1, mkdocs-terminal-4.7.0">
     
     
    
    <link rel="canonical" href="https://github.com/cyruscyliu/cyruscyliu.github.io/posts/2024-07-03-aflnet/"><link rel="icon" type="image/png" sizes="192x192" href="../../img/android-chrome-192x192.png" />
<link rel="icon" type="image/png" sizes="512x512" href="../../img/android-chrome-512x512.png" />
<link rel="apple-touch-icon" sizes="180x180" href="../../img/apple-touch-icon.png" />
<link rel="shortcut icon" type="image/png" sizes="48x48" href="../../img/favicon.ico" />
<link rel="icon" type="image/png" sizes="16x16" href="../../img/favicon-16x16.png" />
<link rel="icon" type="image/png" sizes="32x32" href="../../img/favicon-32x32.png" />


    
 
<title>Tech notes about AFLNet/ChatAFL - Qiang Liu's Homepage</title>


<link href="../../css/fontawesome/css/fontawesome.min.css" rel="stylesheet">
<link href="../../css/fontawesome/css/solid.min.css" rel="stylesheet">
<link href="../../css/normalize.css" rel="stylesheet">
<link href="../../css/terminal.css" rel="stylesheet">
<link href="../../css/theme.css" rel="stylesheet">
<link href="../../css/theme.tile_grid.css" rel="stylesheet">
<link href="../../css/theme.footer.css" rel="stylesheet">
<!-- default color palette -->
<link href="../../css/palettes/default.css" rel="stylesheet">

<!-- page layout -->
<style>
/* initially set page layout to a one column grid */
.terminal-mkdocs-main-grid {
    display: grid;
    grid-column-gap: 1.4em;
    grid-template-columns: auto;
    grid-template-rows: auto;
}

/*  
*   when side navigation is not hidden, use a two column grid.  
*   if the screen is too narrow, fall back to the initial one column grid layout.
*   in this case the main content will be placed under the navigation panel. 
*/
@media only screen and (min-width: 70em) {
    .terminal-mkdocs-main-grid {
        grid-template-columns: 4fr 9fr;
    }
}</style>



     
    
    

    
    <!-- search css support -->
<link href="../../css/search/bootstrap-modal.css" rel="stylesheet">
<!-- search scripts -->
<script>
    var base_url = "../..",
    shortcuts = "{}";
</script>
<script src="../../js/jquery/jquery-1.10.1.min.js" defer></script>
<script src="../../js/bootstrap/bootstrap.min.js" defer></script>
<script src="../../js/mkdocs/base.js" defer></script>
    
    
    
    
    <script src="../../search/main.js"></script>
    

    
</head>

<body class="terminal"><div class="container">
    <div class="terminal-nav">
        <header class="terminal-logo">
            <div id="mkdocs-terminal-site-name" class="logo terminal-prompt"><a href="https://github.com/cyruscyliu/cyruscyliu.github.io/" class="no-style">Qiang Liu's Homepage</a></div>
        </header>
        
        <nav class="terminal-menu">
            
            <ul vocab="https://schema.org/" typeof="BreadcrumbList">
                
                
                <li property="itemListElement" typeof="ListItem">
                    <a href="../.." class="menu-item " property="item" typeof="WebPage">
                        <span property="name">Home</span>
                    </a>
                    <meta property="position" content="0">
                </li>
                
                
                <li property="itemListElement" typeof="ListItem">
                    <a href="../" class="menu-item " property="item" typeof="WebPage">
                        <span property="name">Posts</span>
                    </a>
                    <meta property="position" content="1">
                </li>
                
                    
                    


<li property="itemListElement" typeof="ListItem">
    <a href="#" class="menu-item" data-toggle="modal" data-target="#mkdocs_search_modal" property="item" typeof="SearchAction">
        <i aria-hidden="true" class="fa fa-search"></i> <span property="name">Search</span>
    </a>
    <meta property="position" content="2">
</li>
                    
            </ul>
            
        </nav>
    </div>
</div>
        
    <div class="container">
        <div class="terminal-mkdocs-main-grid"><aside id="terminal-mkdocs-side-panel"><nav>
  
    <ul class="terminal-mkdocs-side-nav-items">
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../..">Home</a>
        
    
    
    
  </li>
        
          



<li class="terminal-mkdocs-side-nav-li">
    
    
    
        
        
            <a class="

    terminal-mkdocs-side-nav-item" href="../">Posts</a>
        
    
    
    
  </li>
        
    </ul>
  
</nav><hr>
<nav>
    <ul>
        <li><a href="#tech-notes-about-aflnetchatafl">Tech notes about AFLNet/ChatAFL</a></li>
        <li><a href="#aflnet-supports-two-channels-one-to-send-and-one-to-receive">AFLNET supports two channels, one to send and one to receive</a></li><li><a href="#the-input-for-aflnet-are-the-pcap-files-containing-the-captured-network-traffic">The input for AFLNET are the pcap files containing the captured network traffic</a></li><li><a href="#state-machine-learner">State Machine Learner</a></li><li><a href="#target-state-selector">Target State Selector</a></li><li><a href="#sequence-selector">Sequence Selector</a></li><li><a href="#sequence-mutator">Sequence Mutator</a></li><li><a href="#some-tips">Some tips</a></li>
    </ul>
</nav>
</aside>
            <main id="terminal-mkdocs-main-content">
    
    
    
    
    

<section id="mkdocs-terminal-content">
    <h1 id="tech-notes-about-aflnetchatafl">Tech notes about AFLNet/ChatAFL<a class="headerlink" href="#tech-notes-about-aflnetchatafl" title="Do what you think is right">#</a></h1>
<h2 id="aflnet-supports-two-channels-one-to-send-and-one-to-receive">AFLNET supports two channels, one to send and one to receive<a class="headerlink" href="#aflnet-supports-two-channels-one-to-send-and-one-to-receive" title="Do what you think is right">#</a></h2>
<ul>
<li>The response-receiving channel forms the state feedback channel.</li>
<li>AFLNET uses standard C Socket APIs (i.e., connect/poll/send/recv).</li>
<li>For synchronization, there is delay between requests. Otherwise, several
server implementations drop the connetion if a new message is received before
the response is sent and acknowledged.</li>
</ul>
<h2 id="the-input-for-aflnet-are-the-pcap-files-containing-the-captured-network-traffic">The input for AFLNET are the pcap files containing the captured network traffic<a class="headerlink" href="#the-input-for-aflnet-are-the-pcap-files-containing-the-captured-network-traffic" title="Do what you think is right">#</a></h2>
<ul>
<li>Use tcpdump to record realistic message exchange (including both requests and responses).</li>
<li>Use Wireshark to extract requests.</li>
<li>[CHATAFL]: In PROFUZZBENCH, the initial seed corpus of LIVE555 comprises only
4 types of client requests out of 10 present in the ground truth: DESCRIBE,
SETUP, PLAY, and TEARDOWN. As it said in the paper, LLM can generate diverse
messages and approximately 55% (plus 24.5% after fixing the session id) of
client requests can be directly accepted by the server with the successful
response code “2xx”.</li>
</ul>
<p>the capability to enrich the initial seeds.</p>
<h2 id="state-machine-learner">State Machine Learner<a class="headerlink" href="#state-machine-learner" title="Do what you think is right">#</a></h2>
<ul>
<li>It takes the server responses and augments the implemented protocol state
machine (IPSM) with newly observed states and transitions.</li>
</ul>
<h2 id="target-state-selector">Target State Selector<a class="headerlink" href="#target-state-selector" title="Do what you think is right">#</a></h2>
<ul>
<li>At the beginning, it randomly selects target states.</li>
<li>After accumulate statistical data, it chooses states according to two
heuristics, i.e., rarely exercised states and a state with higher priority that
has been particularly successful in contributing to an increased code or state
coverage.</li>
</ul>
<h2 id="sequence-selector">Sequence Selector<a class="headerlink" href="#sequence-selector" title="Do what you think is right">#</a></h2>
<ul>
<li>Once a target state is selected, it selects a message sequence (i.e., a seed
input), which can reach the state (including passing by), from the sequence corpus.</li>
<li>If multiple message sequences reaching the same state, it randomly selects one.</li>
</ul>
<h2 id="sequence-mutator">Sequence Mutator<a class="headerlink" href="#sequence-mutator" title="Do what you think is right">#</a></h2>
<ul>
<li>AFLNET splits the original sequence M into three parts: 1) the
prefix M1 is required to reach the selected state s, 2) the candidate
subsequence M2 contains all messages that can be executed after M1 while still
remaining in s, and 3) the suffix M3 is simply the left-over subsequence such
that (M1, M2, M3) = M.</li>
<li>The mutated message sequence M' = (M1, mutate(M2), M3).</li>
<li>Question: does AFLNET gurantee the mutate(M2) still end with state s?</li>
<li>In order to mutate the candidate sequence M2, AFLNET supports the replacement,
insertion, duplication, and deletion of messages</li>
<li>In addition to these protocol-aware mutation operators, AFLNET uses the
common byte-level operators that are known from greybox fuzzing, such as bit
flipping, and the substitution, insertion, or deletion of blocks of bytes.</li>
<li>The mutations are stacked, i.e., several protocol-aware and bytelevel mutation
operators are applied to generate the mutated candidate sequence.</li>
<li>Generated message sequences M' that are considered as “interesting” are added
to the corpus C. A sequence is considered as interesting if the server response
contains new states or state transitions that have not previously been observed;
a sequence is interesting also if it covers new branches in the server’s source
code.</li>
<li>[CHATAFL] LLM can generate the grammar for each type of messages. This is
one-shot. When mutating, the fuzzer will search in the grammar corpus, mark the
mutatable fields in the seed, and mutate the seed, instead of asking the LLM to
generate a new one.</li>
<li>[CHATAFL] Of the LLM-generated client requests, 69% to 89% induced a
transition to a different state, covering all state transitions for each
individual state. When PlateauLen surpasses MaxPlateau, ChatAFL asks LLM to
break the coverage wall.</li>
</ul>
<h2 id="some-tips">Some tips<a class="headerlink" href="#some-tips" title="Do what you think is right">#</a></h2>
<ul>
<li>The tool will be slow in executions per second due to the synchronization
between the client and the server.</li>
<li>The tool should be running for a long time to activate the target state
selector.</li>
</ul>
</section>

<section id="mkdocs-terminal-after-content">
    
</section>
<section id="mkdocs-terminal-revision">
<br>
<aside>
    <p>
        <small>
            <i>Page last updated 2024-07-03. </i>
        </small>
    </p>
</aside>
</section>
            </main>
        </div>
        <hr><footer>
    <div class="terminal-mkdocs-footer-grid">
        <div id="terminal-mkdocs-footer-copyright-info">
             Site built with <a href="http://www.mkdocs.org">MkDocs</a> and <a href="https://github.com/ntno/mkdocs-terminal">Terminal for MkDocs</a>.
        </div>
    </div>
</footer>
    </div>

    
    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="alertdialog" aria-modal="true" aria-labelledby="searchModalLabel">
    <div class="modal-dialog modal-lg" role="search">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="searchModalLabel">Search</h5>
                <button type="button" class="close btn btn-default btn-ghost" data-dismiss="modal"><span aria-hidden="true">x</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p id="searchInputLabel">Type to start searching</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" aria-labelledby="searchInputLabel" placeholder="" id="mkdocs-search-query" title="Please enter search terms here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No document matches found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>
    
    
</body>

</html>